// Anomaly Detection - Unit Tests// Run with: npx tsx lib/tools/evaluation-metrics/__tests__/anomalyDetection.test.tsimport { getAnomalyDetection } from '../operations/anomalyDetection';console.log('========================================');console.log('Anomaly Detection - Unit Tests');console.log('========================================\n');// Test 1: Function existsconsole.log('Test 1: Function exists');console.log('----------------------------------------');if (typeof getAnomalyDetection !== 'function') {  throw new Error('getAnomalyDetection is not a function!');}console.log('✓ getAnomalyDetection function exists\n');// Test 2: Call with valid parametersconsole.log('Test 2: Call with valid parameters');console.log('----------------------------------------');const testUserId = 'test-user-123';const startDate = new Date('2025-01-01');const endDate = new Date('2025-01-31');console.log('Parameters:');console.log('  userId:', testUserId);console.log('  startDate:', startDate.toISOString());console.log('  endDate:', endDate.toISOString());getAnomalyDetection(testUserId, startDate, endDate)  .then((result) => {    console.log('\nResult structure:');    console.log('  period:', result.period);    console.log('  totalEvaluations:', result.totalEvaluations);    console.log('  anomaliesDetected:', result.anomaliesDetected);    console.log('  anomalies count:', result.anomalies.length);    console.log('  insights count:', result.insights.length);        // Validate structure    if (!result.period) throw new Error('Missing period field');    if (typeof result.totalEvaluations !== 'number') throw new Error('Invalid totalEvaluations');    if (typeof result.anomaliesDetected !== 'number') throw new Error('Invalid anomaliesDetected');    if (!Array.isArray(result.anomalies)) throw new Error('anomalies not an array');    if (!result.statistics) throw new Error('Missing statistics');    if (!Array.isArray(result.insights)) throw new Error('insights not an array');        console.log('✓ Test 2 passed - Valid response structure\n');        // Test 3: Validate statistics structure    console.log('Test 3: Statistics structure');    console.log('----------------------------------------');    const stats = result.statistics;    const requiredStats = ['mean', 'median', 'stdDev', 'q1', 'q3', 'iqr'];    requiredStats.forEach(stat => {      if (typeof stats[stat as keyof typeof stats] !== 'number') {        throw new Error(`Missing or invalid statistic: ${stat}`);      }    });    console.log('✓ Test 3 passed - All statistics present\n');        // Test 4: Validate anomaly structure (if any exist)    console.log('Test 4: Anomaly structure');    console.log('----------------------------------------');    if (result.anomalies.length > 0) {      const anomaly = result.anomalies[0];            if (!anomaly.id) throw new Error('Missing anomaly id');      if (!anomaly.timestamp) throw new Error('Missing anomaly timestamp');      if (!anomaly.type) throw new Error('Missing anomaly type');      if (!anomaly.severity) throw new Error('Missing anomaly severity');      if (typeof anomaly.value !== 'number') throw new Error('Invalid anomaly value');      if (!anomaly.expectedRange) throw new Error('Missing expectedRange');      if (typeof anomaly.deviation !== 'number') throw new Error('Invalid deviation');      if (!anomaly.description) throw new Error('Missing description');      if (!Array.isArray(anomaly.contributingFactors)) throw new Error('contributingFactors not array');      if (!anomaly.recommendedAction) throw new Error('Missing recommendedAction');            // Validate severity values      const validSeverities = ['low', 'medium', 'high', 'critical'];      if (!validSeverities.includes(anomaly.severity)) {        throw new Error(`Invalid severity: ${anomaly.severity}`);      }            // Validate anomaly types      const validTypes = [        'statistical_outlier',        'iqr_outlier',        'sudden_drop',        'sudden_spike',        'sustained_degradation'      ];      if (!validTypes.includes(anomaly.type)) {        throw new Error(`Invalid anomaly type: ${anomaly.type}`);      }            console.log('✓ Test 4 passed - Valid anomaly structure\n');    } else {      console.log('✓ Test 4 passed - No anomalies to validate (data too clean or insufficient)\n');    }        // Test 5: Validate anomaly count matches    console.log('Test 5: Anomaly count consistency');    console.log('----------------------------------------');    if (result.anomaliesDetected !== result.anomalies.length) {      throw new Error(        `Mismatch: anomaliesDetected=${result.anomaliesDetected} but anomalies.length=${result.anomalies.length}`      );    }    console.log('✓ Test 5 passed - Anomaly count consistent\n');        // Test 6: Validate expected range structure    console.log('Test 6: Expected range structure');    console.log('----------------------------------------');    if (result.anomalies.length > 0) {      const range = result.anomalies[0].expectedRange;      if (typeof range.lower !== 'number') throw new Error('Invalid expectedRange.lower');      if (typeof range.upper !== 'number') throw new Error('Invalid expectedRange.upper');      if (range.lower > range.upper) throw new Error('Invalid range: lower > upper');      console.log('✓ Test 6 passed - Valid expected range\n');    } else {      console.log('✓ Test 6 passed - No anomalies to validate range\n');    }        console.log('========================================');    console.log('All Anomaly Detection Tests Passed! ✓');    console.log('========================================\n');  })  .catch((error) => {    console.error('\n✗ Test failed:', error.message);    console.error('Stack:', error.stack);    process.exit(1);  });